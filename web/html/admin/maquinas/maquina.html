
<link href="https://fonts.googleapis.com/icon?family=Material+Icons"
      rel="stylesheet">

<div class="section no-pad-bot container" id="index-banner">
    <form id="data-form" name="data-form" class="col s12" enctype="multipart/form-data" method="post">
        <br><br>

        <div class="row">
            <h5 class="input-field col m6 s12">
                <input id="modelo" type="text" class="validate" name="modelo" value="{{modelo}}">
                <label for="modelo">modelo</label>
            </h5>
        </div>

        <div class="row">
            <div class="col l6 m12 s12 card">
                <div class="card-content">
                    <span class="card-title grey-text text-darken-4">Info</span>
                    <ul>
                        <li class="input-field col m6 s12">
                            <input id="eti" type="text" class="validate" name="eti" value="{{eti}}">
                            <label for="eti">ETI</label>
                        </li>
                        <li class="input-field col m6 s12">
                            <input id="pais" type="text" class="validate" name="pais" value="{{pais}}">
                            <label for="pais">pais</label>
                        </li>
                        <li class="input-field col m6 s12">
                            <input id="venta" type="text" class="validate" name="venta" value="{{venta}}">
                            <label for="venta">venta</label>
                        </li>
                        <li class="input-field col m6 s12">
                            <input id="precio" type="text" class="validate" name="precio" value="{{precio}}">
                            <label for="precio">precio</label>
                        </li>
                        <li class="input-field col m6 s12">
                            <input id="aNo" type="text" class="validate" name="aNo" value="{{aNo}}">
                            <label for="aNo">a√±o</label>
                        </li>
                        <li class="input-field col s12">
                            <input id="linkVideo" type="text" class="validate" name="linkVideo" value="{{linkVideo}}">
                            <label for="linkVideo">link video</label>
                        </li>

                        <li class="input-field col s12">
                            <input type="checkbox" id="enEmail" name="enEmail"
                                   {{#enEmail}} checked {{/enEmail}}/>
                            <label for="enEmail">Mostrar en email</label>
                            <br/><br/><br/>
                        </li>
                    </ul>
                </div>
            </div>


            <div class="">
                <div class="col l5 offset-l1 m12 s12 card">
                    <div class="card-content">
                        <span class="card-title grey-text text-darken-4">Agregar imagenes</span>
                        <div class="file-field input-field">
                            <input class="file-path validate" type="text"/>
                            <div class="btn">
                                <span>File</span>
                                <input id="archivosImagenes" type="file" class="validate" name="archivosImagenes" multiple/>
                            </div>
                        </div>

                        {{# primeraImagen}}
                        <div>
                            <!-- Modal Trigger -->
                            <a class="modal-trigger" href="#modal1">
                                <img src="{{primeraImagen}}" style="width: 100%;">
                            </a>

                            <!-- Modal Structure -->
                            <div id="modal1" class="modal">
                                <div class="modal-content container">
                                {{# imagenes}}
                                    <div class="row">
                                        <div class="col s12 s12">
                                            <div class="card">
                                                <div class="card-image">
                                                    <img src="{{href}}">
                                                    <span class="card-title">{{filename}}</span>
                                                </div>
                                                <div class="card-action">
                                                    <a class="red-text text-darken-3 eliminar-foto" href="{{idMaquina}}/imagenes/{{id}}/eliminar">Eliminar</a>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                {{/ imagenes}}
                                </div>
                                <!--div class="modal-footer">
                                    <a href="#!" class=" modal-action modal-close waves-effect waves-green btn-flat">Agree</a>
                                </div-->
                            </div>
                        </div>
                        {{/ primeraImagen}}
                    </div>
                </div>
                <!--VIDEO-->
                {{# hasVideo}}
                <div class="col l5 offset-l1 m12 s12 card">
                    <div class="card-content">
                        <span class="card-title grey-text text-darken-4">Video</span>
                        <!-- Modal Trigger -->
                        <a class="modal-trigger" href="#modalVideo">
                            <div class="center">
                                <img src="http://img.youtube.com/vi/{{linkVideo}}/mqdefault.jpg" alt=""
                                    style="width: 100%"/>
                            </div>
                        </a>
                        <!-- Modal Structure -->
                        <div id="modalVideo" class="modal" style="width: 90%; height: 67%;">
                            <div class="modal-content container center" style="width: 100%; height: 100%;">
                                <iframe src="https://www.youtube.com/embed/{{linkVideo}}?autoplay=0"
                                        frameborder="0"
                                        style="width: 100%; height: 100%;">
                                </iframe>
                            </div>
                        </div>
                    </div>
                </div>
                {{/ hasVideo}}
            </div>
        </div>
        <div class="row">
            <div class="card">
                <div class="card-content">
                    <span class="card-title grey-text text-darken-4">Descripcion</span>
                    <div class="col s12 ">
                        <div class="input-field">
                            <textarea id="descripcion" class="validate" name="descripcion"style="min-height: 200px">{{descripcion}}</textarea>
                            <label for="descripcion">descripcion</label>
                        </div>
                        <br><br>
                    </div>
                </div>
            </div>
        </div>

        <button class="hide" type="submit" name="action" id="save-button">
            Guardar
        </button>
    </form>
    <form action="{{id}}/eliminar" method="post" class="hide">
        <input type="submit" id="delete-button">
    </form>

    <div class="fixed-action-btn" style="bottom: 45px; right: 24px;">
        <!--a class="btn-floating btn-large red">
            <i class="large mdi-editor-mode-edit"></i>
        </a-->
        <label id="data-label" class="btn-floating btn-large waves-effect waves-light" for="save-button">
            <i class="material-icons right">save</i>
        </label>
    </div>

    <label class="btn waves-effect waves-light red" for="delete-button"
            style="float: left">
        Eliminar <i class="material-icons right">delete</i>
    </label>

</div>

<br><br>

<script type="text/javascript" src="https://code.jquery.com/jquery-2.1.4.min.js"></script>
<script src="/js/materialize.min.js"></script>

<script>
    $(document).ready(function(){
        // the "href" attribute of .modal-trigger must specify the modal ID that wants to be triggered
        $('.modal-trigger').leanModal();
    });

    $(document).ready(function(){
        $('.slider').slider({full_width: true});
    });

    var form = document.getElementById('data-form');


    form.onsubmit = function(event) {
        event.preventDefault();


        var files = form["archivosImagenes"].files;

        // Create a new FormData object.
        var formData = new FormData();


        for (var i = 0; i < files.length; i++) {
            var file = files[i];

            // Check the file type.
            if (!file.type.match('image.*')) {
                continue;
            }
            console.log(file);
            // Add the file to the request.
            formData.append('file' + i, file);
        }

        var inputs = form.getElementsByTagName("input");
        for (i = 0; i < inputs.length; i++) {
            if (inputs[i].id == "archivosImagenes")
                continue;
            else if (inputs[i].type == "checkbox")
                formData.append(inputs[i].id, inputs[i].checked);
            else if (inputs[i].type == "textarea")
                formData.append(inputs[i].id, inputs[i].innerHTML);
            else
                formData.append(inputs[i].id, inputs[i].value);
        }

        // Set up the request.
        var url = window.location.pathname;
        var xhr = new XMLHttpRequest();

        xhr.open('POST', url, true);

        xhr.onload = function () {
            if (xhr.status === 200) {
                window.location.href = xhr.responseText;
            } else {
                alert('An error occurred!');
            }
        };

        xhr.send(formData);
    }

</script>